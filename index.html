<!doctype html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Lesson ‚Äî Study</title>

  <style>
    :root{
      --primary:#1c4785;
      --accent:#969696;

      --bg:#0b1220;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.04);
      --border:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.94);
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.56);
      --shadow:0 18px 52px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:24px;
      --max:1040px;

      --step--1: clamp(.9rem,.86rem + .2vw,1rem);
      --step-0: clamp(1rem,.94rem + .35vw,1.12rem);
      --step-1: clamp(1.12rem,1.02rem + .55vw,1.32rem);
      --step-2: clamp(1.25rem,1.1rem + .85vw,1.6rem);
    }

    html[data-theme="light"]{
      --bg:#f6f7fb;
      --panel:rgba(17,24,39,.05);
      --panel2:rgba(17,24,39,.03);
      --border:rgba(17,24,39,.12);
      --text:rgba(17,24,39,.95);
      --muted:rgba(17,24,39,.65);
      --muted2:rgba(17,24,39,.55);
      --shadow:0 14px 36px rgba(17,24,39,.15);
    }

    @media (prefers-color-scheme: light){
      html[data-theme="auto"]{
        --bg:#f6f7fb;
        --panel:rgba(17,24,39,.05);
        --panel2:rgba(17,24,39,.03);
        --border:rgba(17,24,39,.12);
        --text:rgba(17,24,39,.95);
        --muted:rgba(17,24,39,.65);
        --muted2:rgba(17,24,39,.55);
        --shadow:0 14px 36px rgba(17,24,39,.15);
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(900px 420px at 12% -10%, rgba(28,71,133,.40), transparent 62%),
        radial-gradient(900px 420px at 88% 0%, rgba(150,150,150,.22), transparent 62%),
        radial-gradient(900px 520px at 50% 110%, rgba(28,71,133,.14), transparent 62%),
        var(--bg);
      color:var(--text);
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    .wrap{max-width:var(--max);margin:0 auto;padding:18px 14px 60px;}

    .appbar{
      position:sticky;top:0;z-index:50;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      background: linear-gradient(to bottom, rgba(0,0,0,.40), rgba(0,0,0,0));
      border-bottom:1px solid var(--border);
      margin:-18px -14px 10px;
      padding:12px 0 10px;
    }
    html[data-theme="light"] .appbar{
      background: linear-gradient(to bottom, rgba(246,247,251,.95), rgba(246,247,251,0));
    }
    @media (prefers-color-scheme: light){
      html[data-theme="auto"] .appbar{
        background: linear-gradient(to bottom, rgba(246,247,251,.95), rgba(246,247,251,0));
      }
    }

    .appbar .inner{
      max-width:var(--max);
      margin:0 auto;
      padding:0 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .brand{display:flex;align-items:center;gap:10px;min-width:0}
    .mark{
      width:38px;height:38px;border-radius:14px;
      background: linear-gradient(135deg, rgba(28,71,133,.95), rgba(150,150,150,.55));
      box-shadow: var(--shadow);
    }

    .kicker{
      font-size:var(--step--1);
      color:var(--muted);
      letter-spacing:.08em;
      text-transform:uppercase;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    h1{
      margin:2px 0 0;
      font-size:var(--step-2);
      line-height:1.15;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}

    .btn{
      appearance:none;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color:var(--text);
      border-radius:999px;
      padding:10px 12px;
      font-size:var(--step--1);
      display:inline-flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      white-space:nowrap;
      transition:transform .08s ease, background .2s ease;
      text-decoration:none;
    }
    .btn:hover{background:rgba(255,255,255,.1)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(28,71,133,.98), rgba(28,71,133,.70));
      border-color: rgba(28,71,133,.6);
    }
    .btn.ghost{background:rgba(255,255,255,.04)}

    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:14px;
      margin-top:12px;
    }
    @media(min-width:980px){
      .grid{grid-template-columns:1.1fr .9fr;gap:16px}
    }

    .card{
      border:1px solid var(--border);
      background:var(--panel);
      border-radius:var(--radius2);
      padding:14px;
      box-shadow:var(--shadow);
    }

    .card h2{margin:0 0 10px;font-size:var(--step-1)}
    .sub{margin:-6px 0 10px;font-size:var(--step--1);color:var(--muted)}
    .divider{height:1px;background:var(--border);margin:10px 0 12px}
    .kicker2{font-size:var(--step--1);color:var(--muted);letter-spacing:.08em;text-transform:uppercase;margin-bottom:6px}

    .prose{font-size:var(--step-0)}
    .prose p{margin:0 0 10px}

    blockquote{
      margin:0;
      padding:12px;
      border-left:4px solid rgba(28,71,133,.72);
      background: rgba(28,71,133,.12);
      border-radius:14px;
    }

    textarea{
      width:100%;
      min-height:240px;
      resize:vertical;
      border-radius:var(--radius2);
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      color:var(--text);
      padding:12px;
      font-size:var(--step-0);
      line-height:1.55;
      outline:none;
    }
    textarea:focus{
      border-color: rgba(28,71,133,.45);
      box-shadow:0 0 0 6px rgba(28,71,133,.14);
    }

    .small{font-size:var(--step--1);color:var(--muted2);margin-top:8px}

    iframe.pdf{
      width:100%;
      height:70vh;
      border:0;
      border-radius:14px;
      background: rgba(127,127,127,.08);
    }

    @media print{
      .appbar,.no-print{display:none!important}
      body{background:#fff;color:#000}
      .card{box-shadow:none}
    }
  </style>
</head>

<body>
  <div class="appbar">
    <div class="inner">
      <div class="brand">
        <div class="mark"></div>
        <div>
          <div class="kicker">Pauline Epistles</div>
          <h1 id="pageH1">Lesson</h1>
        </div>
      </div>
      <div class="actions">
        <button class="btn ghost" id="themeBtn">üåì Theme</button>
        <a class="btn ghost" id="openPdfBtn" href="#" target="_blank" rel="noopener">üìÑ Open PDF</a>
        <button class="btn" id="downloadBtn">‚¨á Download Notes</button>
        <button class="btn" onclick="window.print()">üñ® Print / PDF</button>
        <button class="btn primary" id="saveBtn">‚úì Save</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <!-- LEFT -->
      <main class="card">
        <div class="kicker2">Chapter Summary</div>
        <div class="prose">
          <p id="summaryText" style="color:var(--muted)">No description provided.</p>
        </div>

        <div class="divider"></div>

        <div class="kicker2">Study PDF</div>
        <div class="small">Preview may be blocked by Adobe. Use ‚ÄúOpen PDF‚Äù if it‚Äôs blank.</div>
        <div id="pdfWrap" style="margin-top:12px;">
          <iframe class="pdf" id="pdfFrame" src=""></iframe>
        </div>

        <div class="divider"></div>

        <div class="kicker2">Logos (KJV) ‚Äî Example</div>
        <blockquote>
          <strong>2 Corinthians 13:5</strong><br>
          Examine yourselves, whether ye be in the faith; prove your own selves...
        </blockquote>
        <div class="small">Later, we can also drive this verse from the sheet.</div>
      </main>

      <!-- RIGHT -->
      <aside class="card">
        <h2>Notes</h2>
        <div class="sub">Your reflections</div>
        <textarea id="notes" placeholder="Write your notes here..."></textarea>

        <div class="no-print" style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
          <button class="btn" onclick="document.getElementById('notes').value=''">üóë Clear</button>
          <button class="btn" onclick="navigator.clipboard?.writeText(notes.value)">üìã Copy</button>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // Read params from the URL (built from your spreadsheet)
    const q = new URLSearchParams(location.search);
    const title = q.get("title") || "Lesson";
    const desc  = q.get("desc") || "";
    const pdf   = q.get("pdf") || "";

    document.title = title + " ‚Äî Study";
    document.getElementById("pageH1").textContent = title;

    if (desc.trim()) {
      const s = document.getElementById("summaryText");
      s.textContent = desc;
      s.style.color = "inherit";
    }

    // PDF wiring
    const openPdfBtn = document.getElementById("openPdfBtn");
    const pdfFrame = document.getElementById("pdfFrame");
    const pdfWrap = document.getElementById("pdfWrap");

    if (pdf) {
      openPdfBtn.href = pdf;
      pdfFrame.src = pdf;
    } else {
      openPdfBtn.href = "#";
      openPdfBtn.onclick = (e) => { e.preventDefault(); alert("No PDF link provided."); };
      pdfWrap.style.display = "none";
    }

    // Theme toggle
    const root = document.documentElement;
    document.getElementById("themeBtn").onclick = () => {
      const t = root.getAttribute("data-theme");
      root.setAttribute("data-theme", t === "dark" ? "light" : "dark");
    };

    // Notes key + filename (unique per lesson)
    const notes = document.getElementById("notes");
    const KEY = "notes_" + title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
    notes.value = localStorage.getItem(KEY) || "";

    document.getElementById("saveBtn").onclick = () => {
      localStorage.setItem(KEY, notes.value);
      alert("Notes saved");
    };

    document.getElementById("downloadBtn").onclick = () => {
      const blob = new Blob([notes.value], {type:"text/plain"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = KEY.replace(/^notes_/, "") + "-notes.txt";
      a.click();
    };
  </script>
</body>
</html>
